<!-- Partes que siempre aparecen en el navbar -->
<%- include('includes/sidenavsup.ejs') %>
  <!-- Para que aparezca Mis Mentorados -->
  <% for (i=0; i < rolesA.length; i++) { %>
    <% if (rolesA[i].idPrivilegio==1) { %>
      <%- include('includes/sideMentorados.ejs') %>
        <% } %>
          <% } %>

            <!-- Para que aparezca Empleados del chapter -->
            <% for (i=0; i < rolesA.length; i++) { %>
              <% if (rolesA[i].idPrivilegio==2) { %>
                <%- include('includes/sideAgregarE.ejs') %>
                  <% } %>
                    <% } %>

                      <!-- Final de la nav-->
                      <%- include('includes/sidenavFin.ejs') %>


                        <!-- Para las rutas -->
                        <h1 id="principal">Este sitio es el principal</h1><br>
                        <input id="idE" value="<% idEmpleado %>" type="hidden">
                        <div id="chart-container" style="position: relative; height:30vh; width:50vw">
                          <!--//Para cambiar tamanio-->
                          <canvas id="mycanvas"></canvas>
                        </div>

                        <div class="container py-5">
                          <div class="row">

                            <!-- For demo purpose -->
                            <div class="col-lg-12 mx-auto mb-5 text-white text-center">
                              <h1 class="display-4">Bootstrap 4 circular progress bar</h1>
                              <p class="lead mb-0">Pure CSS solution to create a circular progress bar compatible with
                                Bootstrap 4. </p>
                              <p class="lead">Snippet by <a href="https://bootstrapious.com/snippets"
                                  class="text-white">
                                  <u>Bootstrapious</u></a>
                              </p>
                            </div>
                            <!-- END -->

                            <div class="col-xl-3 col-lg-6 mb-4">
                              <div class="bg-white rounded-lg p-5 shadow">
                                <h2 class="h6 font-weight-bold text-center mb-4">Overall progress</h2>

                                <!-- Progress bar 1 -->
                                <div class="progress mx-auto" data-value='80'>
                                  <span class="progress-left">
                                    <span class="progress-bar border-primary"></span>
                                  </span>
                                  <span class="progress-right">
                                    <span class="progress-bar border-primary"></span>
                                  </span>
                                  <div
                                    class="progress-value w-100 h-100 rounded-circle d-flex align-items-center justify-content-center">
                                    <div class="h2 font-weight-bold">80<sup class="small">%</sup></div>
                                  </div>
                                </div>
                                <!-- END -->

                                <!-- Demo info -->
                                <div class="row text-center mt-4">
                                  <div class="col-6 border-right">
                                    <div class="h4 font-weight-bold mb-0">28%</div><span class="small text-gray">Last
                                      week</span>
                                  </div>
                                  <div class="col-6">
                                    <div class="h4 font-weight-bold mb-0">60%</div><span class="small text-gray">Last
                                      month</span>
                                  </div>
                                </div>
                                <!-- END -->
                              </div>
                            </div>

                            <div class="col-xl-3 col-lg-6 mb-4">
                              <div class="bg-white rounded-lg p-5 shadow">
                                <h2 class="h6 font-weight-bold text-center mb-4">Work hours</h2>

                                <!-- Progress bar 2 -->
                                <div class="progress mx-auto" data-value='25'>
                                  <span class="progress-left">
                                    <span class="progress-bar border-danger"></span>
                                  </span>
                                  <span class="progress-right">
                                    <span class="progress-bar border-danger"></span>
                                  </span>
                                  <div
                                    class="progress-value w-100 h-100 rounded-circle d-flex align-items-center justify-content-center">
                                    <div class="h2 font-weight-bold">25<sup class="small">%</sup></div>
                                  </div>
                                </div>
                                <!-- END -->

                                <!-- Demo info-->
                                <div class="row text-center mt-4">
                                  <div class="col-6 border-right">
                                    <div class="h4 font-weight-bold mb-0">28%</div><span class="small text-gray">Last
                                      week</span>
                                  </div>
                                  <div class="col-6">
                                    <div class="h4 font-weight-bold mb-0">60%</div><span class="small text-gray">Last
                                      month</span>
                                  </div>
                                </div>
                                <!-- END -->
                              </div>
                            </div>

                            <div class="col-xl-3 col-lg-6 mb-4">
                              <div class="bg-white rounded-lg p-5 shadow">
                                <h2 class="h6 font-weight-bold text-center mb-4">Server time</h2>

                                <!-- Progress bar 3 -->
                                <div class="progress mx-auto" data-value='76'>
                                  <span class="progress-left">
                                    <span class="progress-bar border-success"></span>
                                  </span>
                                  <span class="progress-right">
                                    <span class="progress-bar border-success"></span>
                                  </span>
                                  <div
                                    class="progress-value w-100 h-100 rounded-circle d-flex align-items-center justify-content-center">
                                    <div class="h2 font-weight-bold">76<sup class="small">%</sup></div>
                                  </div>
                                </div>
                                <!-- END -->

                                <!-- Demo info -->
                                <div class="row text-center mt-4">
                                  <div class="col-6 border-right">
                                    <div class="h4 font-weight-bold mb-0">28%</div><span class="small text-gray">Last
                                      week</span>
                                  </div>
                                  <div class="col-6">
                                    <div class="h4 font-weight-bold mb-0">60%</div><span class="small text-gray">Last
                                      month</span>
                                  </div>
                                </div>
                                <!-- END -->
                              </div>
                            </div>

                            <div class="col-xl-3 col-lg-6 mb-4">
                              <div class="bg-white rounded-lg p-5 shadow">
                                <h2 class="h6 font-weight-bold text-center mb-4">Total overdue</h2>

                                <!-- Progress bar 4 -->
                                <div class="progress mx-auto" data-value='12'>
                                  <span class="progress-left">
                                    <span class="progress-bar border-warning"></span>
                                  </span>
                                  <span class="progress-right">
                                    <span class="progress-bar border-warning"></span>
                                  </span>
                                  <div
                                    class="progress-value w-100 h-100 rounded-circle d-flex align-items-center justify-content-center">
                                    <div class="h2 font-weight-bold">12<sup class="small">%</sup></div>
                                  </div>
                                </div>
                                <!-- END -->

                                <!-- Demo info -->
                                <div class="row text-center mt-4">
                                  <div class="col-6 border-right">
                                    <div class="h4 font-weight-bold mb-0">28%</div><span class="small text-gray">Last
                                      week</span>
                                  </div>
                                  <div class="col-6">
                                    <div class="h4 font-weight-bold mb-0">60%</div><span class="small text-gray">Last
                                      month</span>
                                  </div>
                                </div>
                                <!-- END -->
                              </div>
                            </div>
                          </div>
                        </div>

                        <script>

                          const graficas = () => {

                            console.log("a");

                            const new_id = document.getElementById("idE");
                            console.log(new_id);

                            fetch('/users/tops/' + new_id, {
                              method: 'GET',
                              headers: {
                                'Content-Type': 'application/json',
                                //'csrf-token': csrf
                              }
                            }).then(result => {
                              return result.json();
                            }).then(data => {

                              console.log(data);

                              //! Se definen las listas de los valores a desplegar 
                              var nivel_craft = [];
                              var nivel_business = [];
                              var nivel_people = [];
                              var fechas = [];
                              var fechas2 = [];

                              for (var i in data) {
                                if (data[i].idDimension == 1) {
                                  nivel_craft.push(data[i].nivelE.toFixed(1));
                                }
                                else if (data[i].idDimension == 2) {
                                  nivel_people.push(data[i].nivelE.toFixed(1));
                                }
                                else if (data[i].idDimension == 3) {
                                  nivel_business.push(data[i].nivelE.toFixed(1));
                                }

                                if (!(fechas2.includes(data[i].fecha))) {

                                  fechas2.push(data[i].fecha);
                                  let d = data[i].fecha.split("T")[0];
                                  fechas.push(d);
                                }
                              }

                              console.log(nivel_craft);
                              console.log(nivel_business);
                              console.log(nivel_people);
                              console.log(fechas);

                              var chartdata = {
                                labels: fechas,
                                datasets: [
                                  {
                                    label: 'Craft',
                                    backgroundColor: // Color de las barras en la grafica
                                      'rgba(255, 99, 132, 0.2)',

                                    borderColor: // Color del borde de las barras en la grafica  
                                      'rgb(255, 99, 132)',

                                    hoverBackgroundColor: 'rgba(200, 200, 200, 1)',
                                    hoverBorderColor: 'rgba(200, 200, 200, 1)',
                                    data: nivel_craft,
                                  },
                                  {
                                    label: 'People & Mindsets',
                                    backgroundColor: // Color de las barras en la grafica
                                      'rgba(255, 159, 64, 0.2)',

                                    borderColor: // Color del borde de las barras en la grafica  
                                      'rgb(255, 159, 64)',

                                    hoverBackgroundColor: 'rgba(200, 200, 200, 1)',
                                    hoverBorderColor: 'rgba(200, 200, 200, 1)',
                                    data: nivel_people,
                                  },
                                  {
                                    label: 'Commercial & customer',
                                    backgroundColor: // Color de las barras en la grafica
                                      'rgba(255, 205, 86, 0.2)',

                                    borderColor: // Color del borde de las barras en la grafica  
                                      'rgb(255, 205, 86)',

                                    hoverBackgroundColor: 'rgba(200, 200, 200, 1)',
                                    hoverBorderColor: 'rgba(200, 200, 200, 1)',
                                    data: nivel_business,
                                  }
                                ]
                              };

                              var ctx = document.getElementById("mycanvas");

                              var barGraph = new Chart(ctx, {
                                type: 'line',
                                data: chartdata,
                                options: {
                                  responsive: true,
                                  interaction: {
                                    mode: 'index',
                                    intersect: false,
                                  },
                                  stacked: true,
                                  plugins: {
                                    title: {
                                      display: true,
                                      text: 'Niveles de Empleado'
                                    }
                                  },
                                  scales: {
                                    y: {
                                      type: 'linear',
                                      display: true,
                                      position: 'left',
                                      /*ticks: {
                                        min: 0,
                                        max: 5
                                      }*/
                                    },
                                  }
                                },
                              })

                              /*var dimension = [];
                              var nivel = [];
                  
                              for (var i in data) {
                                if (data[i].idDimension == 1) {
                                  nivel_craft.push(data[i].nivelE)
                                }
                                dimension.push(data[i].nombre);
                                nivel.push(data[i].nivelE.toFixed(1));
                              }
                  
                              console.log(dimension);
                              console.log(nivel);
                  
                              var chartdata = {
                                labels: dimension,
                                datasets: [
                                  {
                                    label: 'Nivel de dimensión',
                                    backgroundColor: // Color de las barras en la grafica
                                      ['rgba(255, 99, 132, 0.2)',
                                        'rgba(255, 159, 64, 0.2)',
                                        'rgba(255, 205, 86, 0.2)'],
                  
                                    borderColor: // Color del borde de las barras en la grafica  
                                      ['rgb(255, 99, 132)',
                                        'rgb(255, 159, 64)',
                                        'rgb(255, 205, 86)'],
                  
                                    hoverBackgroundColor: 'rgba(200, 200, 200, 1)',
                                    hoverBorderColor: 'rgba(200, 200, 200, 1)',
                                    data: nivel
                                  }
                                ]
                              };
                  
                              var ctx = document.getElementById("mycanvas");
                  
                              var barGraph = new Chart(ctx, {
                                type: 'line', // Se define el tipo de grafica
                                data: chartdata
                              });*/

                              /*for (let d of data) {
                              }*/

                            }).catch(err => {
                              console.log(err);

                            });
                          };

                          window.onload = function () {
                            graficas();
                          };
                        </script>

                        <!-- javascript -->
                        <!--script type="text/javascript" src="js/jquery.min.js"></script-->
                        <script type="text/javascript" src="js/Chart.min.js"></script>
                        <script type="text/javascript" src="js/app.js"></script>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
                        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
                          integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
                          crossorigin="anonymous"></script>
                        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
                          integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
                          crossorigin="anonymous"></script>

                        <style>
                          .progress {
                            width: 150px;
                            height: 150px;
                            background: none;
                            position: relative;
                          }

                          .progress::after {
                            content: "";
                            width: 100%;
                            height: 100%;
                            border-radius: 50%;
                            border: 6px solid #eee;
                            position: absolute;
                            top: 0;
                            left: 0;
                          }

                          .progress>span {
                            width: 50%;
                            height: 100%;
                            overflow: hidden;
                            position: absolute;
                            top: 0;
                            z-index: 1;
                          }

                          .progress .progress-left {
                            left: 0;
                          }

                          .progress .progress-bar {
                            width: 100%;
                            height: 100%;
                            background: none;
                            border-width: 6px;
                            border-style: solid;
                            position: absolute;
                            top: 0;
                          }

                          .progress .progress-left .progress-bar {
                            left: 100%;
                            border-top-right-radius: 80px;
                            border-bottom-right-radius: 80px;
                            border-left: 0;
                            -webkit-transform-origin: center left;
                            transform-origin: center left;
                          }

                          .progress .progress-right {
                            right: 0;
                          }

                          .progress .progress-right .progress-bar {
                            left: -100%;
                            border-top-left-radius: 80px;
                            border-bottom-left-radius: 80px;
                            border-right: 0;
                            -webkit-transform-origin: center right;
                            transform-origin: center right;
                          }

                          .progress .progress-value {
                            position: absolute;
                            top: 0;
                            left: 0;
                          }

                          /*
                          *
                          * ==========================================
                          * FOR DEMO PURPOSE
                          * ==========================================
                          *
                          */

                          body {
                            background: #ff7e5f;
                            background: -webkit-linear-gradient(to right, #ff7e5f, #feb47b);
                            background: linear-gradient(to right, #ff7e5f, #feb47b);
                            min-height: 100vh;
                          }

                          .rounded-lg {
                            border-radius: 1rem;
                          }

                          .text-gray {
                            color: #aaa;
                          }

                          div.h4 {
                            line-height: 1rem;
                          }
                        </style>